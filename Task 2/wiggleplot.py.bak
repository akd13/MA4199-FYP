# -*- coding: utf-8 -*-
"""WigglePlot.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/13G0-Fu6E1a0Dqd3ocDOnM3RY76-sjVpe
"""

from google.colab import drive
drive.mount('/content/gdrive')

import pandas as pd
import numpy as np
import json
import os
import matplotlib.pyplot as plt

os.listdir('gdrive/My Drive/Task 2')

length=0
df = pd.read_csv('gdrive/My Drive/Task 2/BLFiles/ATCACG-s_7_1_genome.36.bl',sep='	',header=None)
length+=df.shape[0]
df.shape[0]

for i in range(18,35):
    df_curr=pd.read_csv('gdrive/My Drive/Task 2/BLFiles/ATCACG-s_7_1_genome.'+str(i)+'.bl',sep='	',header=None)
    df = df.append(df_curr)
    length+=df_curr.shape[0]

df.shape
print(length)

df.head(5)

df = df[ (df[10]!= 'rRNA') & (df[11]!='tRNA')]

df_known_genes = pd.read_csv('gdrive/My Drive/Task 2/refFlat_240118.txt',sep='	',header=None)

df_known_genes.head()

for chr in range(21,22):
  position_read = {}
  df_new = df[ df[1]== 'chr'+str(chr)]
  X = df_new[[8,9]].values
  for x in X:
      if((not np.isnan(x[0])) and (not np.isnan(x[1]))):
          for i in range(int(x[0]),int(x[1])+1):
              if(i not in position_read):
                position_read[i]=1
              else:
                position_read[i]+=1
  df_known_chr = df_known_genes[ df_known_genes[2]== 'chr'+str(chr)]
  X = df_known_chr[[9,10]].values
  known_positions = set()
  for x in X:
    start = x[0].split(',')[:-1]
    end = x[1].split(',')[:-1]
    num_pos = len(start)
    for i in range(num_pos):
      known_start = int(start[i])
      known_end = int(end[i])
      for j in range(known_start, known_end+1):
        if j not in known_positions:
          known_positions.add(j)
  range_chromosome_positions = max(position_read)-min(position_read)
  wiggle_known = [0] * range_chromosome_positions
  wiggle_unknown = [0] * range_chromosome_positions
  for i in range(1,range_chromosome_positions+1):
    if(i in position_read and i in known_positions):
      wiggle_known[i]=position_read[i]
    if(i in position_read and i not in known_positions):
      wiggle_unknown[i]=position_read[i]
  fig = plt.figure(figsize=(15,15))
  plt.title('chr'+str(chr))
  plt.xlabel('Gene Positions')
  plt.ylabel('Number of Reads')
  plt.plot(range(min(position_read),max(position_read)), wiggle_known, 'r') # plotting t, a separately 
  plt.plot(range(min(position_read),max(position_read)), wiggle_unknown, 'b') # plotting t, b separately 
  plt.savefig('gdrive/My Drive/Task 2/ATCACG-s_7_1/ATCACG-s_7_1_chr'+str(chr)+'.png', dpi=fig.dpi)
  plt.show()
  with open('gdrive/My Drive/Task 2/ATCACG-s_7_1/known_ATCACG-s_7_1_chr'+str(chr)+'.txt','w') as file:
    file.write(json.dumps(wiggle_known))
  with open('gdrive/My Drive/Task 2/ATCACG-s_7_1/unknown_ATCACG-s_7_1_chr'+str(chr)+'.txt','w') as file:
    file.write(json.dumps(wiggle_unknown))